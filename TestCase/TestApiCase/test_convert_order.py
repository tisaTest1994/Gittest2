from Function.api_function import *
import allure
import datetime
from decimal import *


# convert order相关cases
class TestConvertOrderApi:

    @allure.testcase('test_convert_order_001 根据id编号查询单笔交易')
    def test_convert_order_001(self):
        time_list = get_zero_time(day_time='2021-05-14')
        cfx_info = []
        for i in time_list:
            info = sqlFunction().get_cfx_detail(end_time=i)
            if info is not None:
                cfx_info.append(info)
        print(cfx_info)
        #cfx_info = [{'id': 29, 'deal_no': '18d433de-70b8-40a6-b6b1-9ef68a82d506', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 2, 54, 7), 'transaction_time': datetime.datetime(2021, 5, 14, 2, 54, 8), 'trading_amount': '0.04895093', 'pnl_amount': '0.63798692', 'rate': '13.03319315', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620960900, 'gnl': '0.0006392898451233'}, {'id': 37, 'deal_no': 'dee37466-e8ec-436d-8de4-a6b4df0f29ea', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 2, 55, 36), 'transaction_time': datetime.datetime(2021, 5, 14, 2, 55, 36), 'trading_amount': '0.14873291', 'pnl_amount': '568.24401', 'rate': '3820.56675', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620960960, 'gnl': '1.9360191062425'}, {'id': 41, 'deal_no': '798bba77-43d3-4e94-a61b-1b8c2e51ed4e', 'counterparty': '5b879a4e-b96a-4e82-9094-f4e7edf96fc0', 'created_at': datetime.datetime(2021, 5, 14, 3, 2, 15), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 2, 16), 'trading_amount': '0.01', 'pnl_amount': '0.13046275', 'rate': '0.076650230756976', 'trading_direction': 1, 'pnl_direction': 2, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620961380, 'gnl': '0.12956631479243024'}, {'id': 42, 'deal_no': 'ee294432-aea3-475c-8b37-4fa12885d2a8', 'counterparty': '5b879a4e-b96a-4e82-9094-f4e7edf96fc0', 'created_at': datetime.datetime(2021, 5, 14, 3, 7, 4), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 7, 4), 'trading_amount': '0.01', 'pnl_amount': '0.13028601', 'rate': '0.076754209043094', 'trading_direction': 1, 'pnl_direction': 2, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620961680, 'gnl': '0.12938871190956906'}, {'id': 43, 'deal_no': '73877c9a-8f27-4469-8c63-27e7d1801265', 'counterparty': '5b879a4e-b96a-4e82-9094-f4e7edf96fc0', 'created_at': datetime.datetime(2021, 5, 14, 3, 8, 57), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 8, 58), 'trading_amount': '0.01', 'pnl_amount': '0.1302878', 'rate': '0.0767531547079729', 'trading_direction': 1, 'pnl_direction': 2, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620961740, 'gnl': '0.129390510952920271'}, {'id': 44, 'deal_no': 'b0a63050-18f2-49a1-b00e-6637e41dffed', 'counterparty': '5b879a4e-b96a-4e82-9094-f4e7edf96fc0', 'created_at': datetime.datetime(2021, 5, 14, 3, 9, 5), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 9, 6), 'trading_amount': '0.01', 'pnl_amount': '0.1302878', 'rate': '0.0767531547079729', 'trading_direction': 1, 'pnl_direction': 2, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620961800, 'gnl': '0.129390510952920271'}, {'id': 46, 'deal_no': '2057f9d7-4546-4af9-9406-81d735db8dda', 'counterparty': 'fa546596-39ae-4b79-bb75-196e2dc6e6cf', 'created_at': datetime.datetime(2021, 5, 14, 3, 49, 23), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 49, 24), 'trading_amount': '0.00261871', 'pnl_amount': '10', 'rate': '3818.66485', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620964200, 'gnl': '0.0101209213435'}, {'id': 47, 'deal_no': '4f44f0c1-9cb5-459b-8dc8-2464310a05c7', 'counterparty': 'fa546596-39ae-4b79-bb75-196e2dc6e6cf', 'created_at': datetime.datetime(2021, 5, 14, 3, 51, 25), 'transaction_time': datetime.datetime(2021, 5, 14, 3, 51, 25), 'trading_amount': '0.00262559', 'pnl_amount': '10', 'rate': '3808.65485', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620964320, 'gnl': '0.0101212556115'}, {'id': 48, 'deal_no': 'bf9da6fc-0e1d-4075-a9ad-9ae6b2ed9816', 'counterparty': 'fa546596-39ae-4b79-bb75-196e2dc6e6cf', 'created_at': datetime.datetime(2021, 5, 14, 4, 57, 27), 'transaction_time': datetime.datetime(2021, 5, 14, 4, 57, 28), 'trading_amount': '0.00264692', 'pnl_amount': '10', 'rate': '0.0002646921199197', 'trading_direction': 1, 'pnl_direction': 2, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620968280, 'gnl': '9.990137109381133942147676'}, {'id': 49, 'deal_no': '884b26ec-b9a8-499c-9a25-0df3a991ae73', 'counterparty': 'fa546596-39ae-4b79-bb75-196e2dc6e6cf', 'created_at': datetime.datetime(2021, 5, 14, 5, 44, 8), 'transaction_time': datetime.datetime(2021, 5, 14, 5, 44, 8), 'trading_amount': '0.00261566', 'pnl_amount': '10', 'rate': '3823.1193', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620971100, 'gnl': '0.010120773238'}, {'id': 50, 'deal_no': 'cdd55260-ced4-462b-ba13-621684a430e1', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 9, 59, 1), 'transaction_time': datetime.datetime(2021, 5, 14, 9, 59, 1), 'trading_amount': '0.1664425', 'pnl_amount': '2.13010264', 'rate': '12.79782893', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1620986400, 'gnl': '0.002133837789475'}, {'id': 58, 'deal_no': '5454da73-9d0d-47a0-b911-689e39589593', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 10, 0, 10), 'transaction_time': datetime.datetime(2021, 5, 14, 10, 0, 10), 'trading_amount': '0.16757343', 'pnl_amount': '662.652447', 'rate': '3954.40045', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1620986460, 'gnl': '0.6703691280435'}, {'id': 62, 'deal_no': 'b1558a53-6a1c-4cb8-96b4-be9a145dbcec', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 18, 9, 3), 'transaction_time': datetime.datetime(2021, 5, 14, 18, 9, 4), 'trading_amount': '0.03486569', 'pnl_amount': '0.42978928', 'rate': '12.3269977', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 2, 'aggregation_no': 1621015800, 'gnl': '0.0004303419818165'}, {'id': 70, 'deal_no': '01ba30aa-7447-4817-9776-6792c9ba0cdf', 'counterparty': '0f9e2184-2708-4a81-8aff-44f25781968e', 'created_at': datetime.datetime(2021, 5, 14, 18, 10, 13), 'transaction_time': datetime.datetime(2021, 5, 14, 18, 10, 13), 'trading_amount': '0.01624373', 'pnl_amount': '66.794346', 'rate': '4112.0079', 'trading_direction': 2, 'pnl_direction': 1, 'maturity_date': '', 'source_type': 1, 'book_id': 3, 'aggregation_no': 1621015860, 'gnl': '0.107336943467'}]
        cfx_list = []
        for y in cfx_info:
            cfx_dict = {}
            if y['book_id'] == 1:
                if y['trading_direction'] == 1:
                    print(1)
                elif y['trading_direction'] == 2:
                    print(2)
                print(y)
            elif y['book_id'] == 2:
                if y['trading_direction'] == 1:
                    print(1)
                elif y['trading_direction'] == 2:
                    print(2)
            elif y['book_id'] == 3:
                print(y)
            cfx_list.append(cfx_dict)